---
title: 热点解读｜椭圆曲线加密：比特币加密的数学基础
subtitle: 
author: 曲政
date: 2019-12-26
slug: 
tags:
- 
categories:
- Reference
typora-root-url: ../../static
show_toc: yes
---

你好，欢迎来到我的《数学通识 50 讲》。

这次的内容大家可以和上一次谈论数据资产的加餐一起学习，那一次主要是从法律和商业的角度谈如何将数据变成资产，这一次我们谈谈这里面的一些技术问题。我们以区块链最广泛的应用，也就是比特币来说明。

比特币大家已经不陌生了，很多人之所以相信它的价值，是因为大家觉得靠数学算法背书比靠政府背书更合理，后者可能有太多的人为因素。至于比特币背后的技术，其实大部分人并不了解，有了之前我们学的数学基础，我们就可以谈谈比特币或者更广泛地讲，区块链的数学基础了。

## 为什么加密的本质是数学的不对称性？

从数学上讲，所有的加密货币之所以能够流通，而且不被破解，靠的是数学上一种不对称的美。人们通常喜欢对称，厌恶不对称，觉得后者不完美。在获取信息时，大家都希望透明，因为不透明、藏着掖着总让人感觉不踏实。但是，不对称有时却自有其妙处与美感，比如黄金分割就是不对称的。

对于信息安全来讲，完全透明、完全对称会带来很多安全隐患。当我们自己是信息的拥有者时，其实并不希望别人可以获得我们的信息，特别是私密信息，只不过常常为了便利，不得不开放许多信息的访问权限，好让对方验证真伪，知道我们是谁，或者能够让对方进行一些统计，来为我们提供更好的服务。过去，我们不开放信息，很多事情就做不成，比如你向银行申请贷款时，几乎就是把所有个人和财务信息开放给了银行。

在完全开放信息的社会里，彻底保护信息安全几乎是天方夜谭，这些我们在上一次加餐里已经说了。要想保护私有信息，特别是隐私，必须有一套不对称的机制，做到在特定授权的情况下，不需要拥有信息也能使用信息，在不授予访问信息的权限时，也能验证信息。

而比特币的意义就在于，它证实了我们可以通过加密和授权，兼顾保护信息不外泄，而且某些得到授权的人还能使用信息。

比特币做到这一点，是靠加密的密钥和解密所需要的密钥不是同一把这个特性。加密时用的密钥是所谓的私钥，只有比特币的主人有，解密的人用的则是由私钥生成的公钥，它可以给任何人。

这种加密的不对称性就在于，在有限的计算时间里，无法从公钥倒推出私钥。因此你可以认为拿着私钥的人，能看到全部信息，而拿到公钥的人，只能看到部分信息或者只验证信息的真伪。为了进一步理解这种非对称的特性，我们不妨看一个具体的例子。

假如，我们要卖房子，首先就要证明这个房子属于我们，有资格出售，过去我们要让买主看房产证，并且要由有关部门或者公证机构证明房产证是真的。这样来回来去多次，买房的人对你的很多信息就了解了，他们甚至就可以伪造一份和你一模一样的房契。

在未来，数字化的房产证可以用区块链来保存，作为房主，区块链的算法会给我们一个私钥，全部信息在你手上。然后可以产生相应的公钥给购房者，用于验证我们房主的所有权，这就足够了，购房者不需要了解我们的其他信息。

这个利用区块链协议验证房产证的过程，可以用一张图来说明：

当然，需要说明的是，购买者使用公钥后验证了房契的真伪。如果他购买了房子，房契会转到他的名下，并作废原来房主的私钥，然后新房主可以拥有新的私钥，这个过程都会记录在区块链的账本里。

![img](https://piccdn3.umiwi.com/img/201912/25/201912251516336657213412.png@700w_1l_1an.src)

接下来，我们就来看看这件事在数学上是怎么做到的。我们还是以比特币协议为例来说明。它采用的是一种被称为椭圆曲线加密的方法。相比目前比较流行的 RSA 加密算法，采用椭圆曲线加密方法可以用更短的密钥达到相当或更好的加密效果。

那么，什么是椭圆曲线加密呢？我们就要从椭圆曲线及其性质说起。

椭圆曲线其实和椭圆没有什么关系，它是具有如下性质的一组曲线： ![img](https://piccdn3.umiwi.com/img/201912/25/201912251518004192339694.jpg@33p.src) 

这一类曲线的形状如下图所示：

![img](https://piccdn3.umiwi.com/img/201912/25/201912251518556588094339.png@700w_1l_1an.src) 椭圆曲线加密的原理

这种曲线的特点是上下对称，非常平滑，具有很多很好的性质，特别是从曲线上的任意一点（图中的 A 点）画一条直线，它最多和曲线本身有三个交点（包括该点本身）。

那么这样一种曲线，与加密有什么关系呢？我们用下面的图来说明。

![img](https://piccdn3.umiwi.com/img/201912/25/201912251519497906612346.png@700w_1l_1an.src) 椭圆曲线上的点乘运算过程

在图中，我们从 A 点出发，画一条线经过 B 点，最后又和曲线交于 C 点。利用这条性质，我们定义一种运算，叫做点乘 “・”，我们用

A・B=C

来表示这三个点之间的关系，意思就是：从 A 点向 B 点连线，与曲线相交于 C 点。由于椭圆曲线是相对 x 轴对称的，因此我们做 C 关于 x 轴的对称点 D，把 D 作为新的一个点，再与 A 点连一条线。于是，便与椭圆曲线又有了一个交点 E，这么一连，就得到

A・D=E

然后我们可以不断重复这个过程。假设我们最后经过 K 次这样的点乘运算，停到了 Z 点。

* 注：在这个过程中，有四点需要作一下说明：*

* 首先，点乘这个运算满足交换律和结合律，因此先算哪一步，后算哪一步结果是一样的。这个性质我们就不证明了。*

* 其次，有可能这样的点乘计算了若干次后，某个交点的 x 值，即横坐标非常大，为了防止不断迭代后计算结果发散，我们在右边某个横坐标很大的地方设一个边界 Max（最大值），超过 Max 后，再让直线反射回来。*

* 再其次，虽然图中的曲线是连续的，每一个点的取值是实数，但是我们在真正使用时，是通过某种变换将它离散化了，因此所有的点都是整数值。*

* 最后，有人可能担心，经过这一次次的运算，会不会又回到原来某个点了。这个不用担心，这个操作有点像两个巨大的素数相乘后，再对某个素数相除取余数（也被称为模运算，Mod），只要算法设计得好，和原来某个点重复的可能性近乎为零。*

如果我们把上述曲线操作中的点乘想象为数字的乘法，经过 K 次点乘，就相当于做了 K 次方的乘方，那么当给定起点 A 和终点 Z 之后，K 其实相当于以 A 为底 Z 的对数。因此，这种计算的过程便被称为椭圆曲线的离散对数计算。那我为什么要给你讲这个连来连去的计算过程呢？

我上面说的椭圆曲线的计算有一个特点，如果我告诉你一开始是从 A 经过 B 到 C，再到 D，到 E 等等，一共走了 K 步，你可以推算出最后停到了 Z，这一过程直观而简单。但是，如果我告诉你起点是 A，终点是 Z，你要想猜出我经过了多少步完成上述过程，这几乎是不可能的，或者说，计算量是极大的。这种不对称性使得验证结果非常容易，但是想破解密码却难上加难。

具体到比特币所使用的加密协议，是一种被称为 SECP256K1 的标准，采用的就是下面这条非常简单的椭圆曲线： ![img](https://piccdn3.umiwi.com/img/201912/25/201912251522350276621330.jpg@33p.src) 

![img](https://piccdn3.umiwi.com/img/201912/25/201912251523018646063842.png@700w_1l_1an.src)

利用上面这个在形式上非常简单的曲线，我们就完成了在外界看来非常复杂的加密。

椭圆曲线的加密方法有很多种，它们的算法和密钥的长度虽然各不相同，但是它们的原理却大同小异。美国国家标准与研究院已经规定了这一类算法的最小密钥长度为 160 位，再往上还有 192 位、224 位，等等。它们都比 RSA 所要求的最短 1024 位短很多，这是椭圆曲线加密的优势所在。

那么这么短的密钥安全么？事实上，2003 年，一个研究团队用一万台 PC 花了一年半时间破解了一个较短的 109 位密钥。但是，破译的时间是随着密钥长度呈指数增长的，破解 160 位的密钥需要大约 1 亿倍的计算量，破译 192 位、224 位的密钥就更难了。因此，除非计算机的速度有百万倍的提升，否则很难破译椭圆曲线加密的信息。

当然，2019 年 Google 在量子计算上取得了突破，在特定计算中，可以将原来需要上万年才能完成的计算在瞬间完成。因此很多人担心区块链的加密是否还安全，应该讲如果 Google 的技术真能走出实验室，而且能用于更多的计算，而不仅是特定的计算，目前的区块链加密算法要修改。

但是，椭圆曲线加密的思想依然是安全的，因为加密（以及验证密码的难度）和解密永远不对称，就算计算机的计算能力提高了万亿倍，那么可以使用更复杂一点的加密，那样量子计算也无济于事。总之，只要数学的这种非对称性存在，加密就是安全的。

说到椭圆曲线，还要补充一个信息，就是我们前面讲到的怀尔斯证明费马大定理，用的就是这个工具。最初日本数学家谷山丰发现椭圆曲线可能和费马大定理有关联，然后另一位日本数学家志村五郎进一步完善了他的想法，形成了所谓的 “谷山 - 志村猜想”，怀尔斯是从他们的工作中得到启发，最终完成了对费马大定理的证明。

从这里大家可以看出，那些看似没有用的数学理论，最后可能会有很大的实际用途，而且数学各个分支，很多时候是相关联的。

好，通过这一讲的加餐，希望你已经从数学上理解了加密货币的安全性。欢迎你把文章分享给那些想了解加密货币计算原理的好朋友。下一篇的加餐，我为大家推荐一本新书。下一讲见。


### 用户留言


  - 捻宏 14 赞

    吴老师好，50 讲慢慢把它听完了。在数学认知的整体上面还是有一些进步，由于记忆力的问题，我觉得我觉得还不是太深入，您的讲话能不能像整理成为书出版，我期待你们有线下书

    2019 年 12 月 29 日

    作者回复会写成书的 2019 年 12 月 31 日


  - Allelujah 朱磊 25 赞

    双线性映射已经在密码学中发现了大量的应用，例如基于身份的加密。 其缺点是 * 同长度密钥下加密和解密操作的实现比其他机制花费的时间长 *，但由于可以使用更短的密钥达到同级的安全程度，所以同级安全程度下速度相对更快。 也就是说，由于椭圆曲线加密的运算过程相对类似 RSA 一类的算法更复杂，所以加密和解密的时间花费可能会更久🤔当量子计算的使用更广泛、椭圆曲线加密不得不加长密钥的时候，似乎会对使用时的加密、解密效率产生一定程度的影响。

    2019 年 12 月 26 日


  - 佛祖门徒 19 赞

    感谢老师的持续加餐，我感觉这一次有勇气把区块链和比特币的基本原理向别人讲清楚了。 “那些看似没有用的数学理论，最后可能会有很大的实际用途，而且数学各个分支，很多时候是相关联的”，给我两点启发：一是学习数学应该积极掌握各分支之间的关联性，不仅能够融会贯通，而且能够加深对某一个具体知识点的理解；二是数学思维和数学原理都能更好的应用在很多方面，关键在于是否真正掌握了其底层原理。

    2019 年 12 月 26 日


  - 李玳蒙 19 赞

    椭圆曲线密码学（英语：Elliptic curve cryptography，缩写为 ECC），一种建立公开密钥加密的演算法，基于椭圆曲线数学。椭圆曲线在密码学中的使用是在 1985 年由 Neal Koblitz 和 Victor Miller 分别独立提出的。 ECC 的主要优势是在某些情况下它比其他的方法使用更小的密钥 —— 比如 RSA 加密算法 —— 提供相当的或更高等级的安全。ECC 的另一个优势是可以定义群之间的双线性映射，基于 Weil 对或是 Tate 对；双线性映射已经在密码学中发现了大量的应用，例如基于身份的加密。不过一个缺点是加密和解密操作的实现比其他机制花费的时间长。[1] 基于这个秘密值，用来对 Alice 和 Bob 之间的报文进行加密的实际方法是适应以前的，最初是在其他组中描述使用的离散对数密码系统。这些系统包括： Diffie-Hellman—ECDH MQV—ECMQV ElGamal discrete log cryptosystem—ECElGamal 数字签名算法 —ECDSA 对于 ECC 系统来说，完成运行系统所必须的群操作比同样大小的因数分解系统或模整数离散对数系统要慢。不过，ECC 系统的拥护者相信 ECDLP 问题比 DLP 或因数分解问题要难的多，并且因此使用 ECC 能用小的多的密钥长度来提供同等的安全，在这方面来说它确实比例如 RSA 之类的更快。已经公布的结果趋于支持这个结论，不过一些专家表示怀疑。 ECC 被广泛认为是在给定密钥长度的情况下，最强大的非对称算法，因此在对带宽要求十分紧的连接中会十分有用。 优势 1. 安全性高 有研究表示 160 位的椭圆密钥与 1024 位的 RSA 密钥安全性相同。 2. 处理速度快 在私钥的加密解密速度上，ecc 算法比 RSA、DSA 速度更快。 3. 存储空间占用小。 4. 带宽要求低。 第六届国际密码学会议对应用于公钥密码系统的加密算法推荐了两种：基于大整数因子分解问题（IFP）的 RSA 算法和基于椭圆曲线上离散对数计算问题（ECDLP）的 ECC 算法。RSA 算法的特点之一是数学原理简单、在工程应用中比较易于实现，但它的单位安全强度相对较低。用国际上公认的对于 RSA 算法最有效的攻击方法 -- 一般数域筛 (NFS) 方法去破译和攻击 RSA 算法，它的破译或求解难度是亚指数级的。ECC 算法的数学理论非常深奥和复杂，在工程应用中比较难于实现，但它的单位安全强度相对较高。用国际上公认的对于 ECC 算法最有效的攻击方法 --Pollard rho 方法去破译和攻击 ECC 算法，它的破译或求解难度基本上是指数级的。正是由于 RSA 算法和 ECC 算法这一明显不同，使得 ECC 算法的单位安全强度高于 RSA 算法，也就是说，要达到同样的安全强度，ECC 算法所需的密钥长度远比 RSA 算法低。这就有效地解决了为了提高安全强度必须增加密钥长度所带来的工程实现难度的问题。

    2019 年 12 月 26 日


  - 独行千里 18 赞

    加密和解密之间的不对称性造成了，你知道我是从哪里来的，但是你不知道我是怎么来的，当你把我所有可能的路径都尝试完一遍之后，你发现我已经不在原来的地方了。

    2019 年 12 月 26 日


  - Christian New11 赞

    我现在感觉大学本科学到的很多理论缺的就是和实际应用的场景的结合，或者说能总结出一个方法论获得可叠加进步，我在得到弥补了这一点但还远不够。

    2019 年 12 月 26 日


  - 怡生 6 赞

    这次区块链又让我了解了一些，真有趣

    2019 年 12 月 26 日


  - 头发末梢的遗憾 5 赞

    解铃还须系铃人，非对称性加密运算的加密过程是单向的，公钥加密后的密文只能用其对应的私钥来解密，消除了交易双方互换密钥的需要，因此非对称性加密算法安全性大大提高。 在交易比特币的时候，公钥生成了钱包地址用于接收比特币，而私钥则是用于支付比特币的时候用到的个人签名。支付比特币的时候，要在交易中提交自己的公钥和该交易的签名，以证明支付者拥有该比特币所有权。

    2019 年 12 月 26 日


  - 红 4 赞

    自己以前也试着去了解过区块链，最后的结果是花了时间 自己越看越迷糊。原因是 本来是想去了解区块链 结果遇到很多其它的新概念（也不懂）去解释区块链。越学越迷，最后干脆不学了 。 语言表述容易懂（不会用大量我不懂的词 来解释另一个我不懂的词） 。这是我愿意听吴军老师的课程的原因之一。

    2019 年 12 月 26 日


  - 雾欣雨鲜 4 赞

    比特币最底层的原理

    2019 年 12 月 26 日


  - 唐学长 4 赞

    数学上的不对称性是加密的理论基础

    2019 年 12 月 26 日


  - 花公鸡2 赞

    现在很多媒体为了让大众了解区块链的原理，做了很多浅显易懂的类比解说，其实已经做的很好了。但是在专业上解释的浅显易懂，几乎没有。吴军老师这份关于区块链的加餐，既专业、又浅显易懂，怕没有第二家了！看完之后我一直兴奋了很长时间……

    2019 年 12 月 31 日


  - 内含子 2 赞

    密码学世界有一个柯克霍夫原则：即使密码系统的任何细节已为人熟知，只要密钥（key）未泄露，它也应是安全的。非对称加密方法满足这一原则。 椭圆曲线算法在比特币体系里占据重要地位，是比特币钱包安全性的密码学基石，也是比特币被称为密码学货币（Cryptography）的原因。

    2019 年 12 月 27 日


  - 晓敏 0 赞

    吴老师的这次课程不多听几遍都不敢留言，虽然好歹也是理工科出身😂

    2019 年 12 月 30 日


  - 星空的想象 0 赞

    非对称之美。 我所知道的非对称之美 —— 黄金分割 椭圆曲线所标识的信息不对称，使信息加密变得更难破解。 椭圆曲线居然与费马大定理有关，椭圆曲线能使信息加密更简单，数学的魔力让人着迷。 可以想象，那些被数学吸引的人对数学的热爱。

    2019 年 12 月 29 日


  - Bruce0 赞

    易守难攻 关于加密的思想，在数学上保证的就是这样一个状态，好的做法是加密过程简单，但是解密则相对难很多，甚至是指数上升的。

    2019 年 12 月 26 日


  - 自横 0 赞

    这讲内容我要收藏，佩服吴军老师讲道理深入浅出的能力，或许也就是语文通识课中，所说的理解他人，表达自己！

    2019 年 12 月 26 日


    从数学上理解比特币，看清底层原理。 比特币通过加密和授权，保护信息不外泄，而且得到授权的人还能使用信息。 比特币的特性是加密的秘钥和解密所需要的秘钥不是同一把。加密是用的秘钥是私钥，只有比特币的主人持有，解密的人用的则是由私钥生成的公钥，可以给任何人用。 比特币协议采用的是椭圆线机密方法，其本质是数学的不对称性，验证结果容易，破解密码极难。

    2019 年 12 月 26 日

- 以上留言由 作者 筛选显示
